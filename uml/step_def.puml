@startuml step_def
title StepDef - Dynamic Resolution

class StepDef <<struct>> {
  type: StepType
  target: Entity
}

enum StepType {
  Fill
  Work
  Store
}

class GroupSteps <<component>> {
  steps: []const StepDef
  current_index: u8
}

interface "Callbacks" as callbacks {
  findSource(registry, target): ?Entity
  findDestination(registry, source): ?Entity
  canUnblock(registry, group): bool
  groupScorer(registry, worker, group): ?f32
}

GroupSteps --> StepDef : contains
StepDef --> StepType : has

note right of StepDef
  target meaning depends on StepType:

  Fill: target = destination (internal input)
        source = resolved via findSource

  Work: target = workstation

  Store: target = source (internal output)
         destination = resolved via findDestination
end note

note bottom of StepType
  Fill:  dynamic source → fixed target
  Work:  work at target workstation
  Store: fixed source → dynamic destination
end note

@enduml

@startuml components
title labelle-tasks Components

package "Common" {
  enum Priority {
    Low
    Normal
    High
    Critical
  }

  enum InterruptLevel {
    None
    Low
    High
    Atomic
  }
}

package "Standalone Tasks" {
  enum TaskStatus {
    Queued
    Active
    Completed
    Cancelled
  }

  class Task <<component>> {
    status: TaskStatus
    priority: Priority
    interrupt_level: InterruptLevel
  }

  class AssignedTo <<component>> {
    worker: Entity
  }

  class CurrentTask <<component>> {
    task: Entity
  }

  note bottom of AssignedTo
    Added to task entity
  end note

  note bottom of CurrentTask
    Added to worker entity
  end note
}

package "Task Groups" {
  enum TaskGroupStatus {
    Blocked
    Queued
    Active
  }

  class TaskGroup <<component>> {
    status: TaskGroupStatus
    priority: Priority
    interrupt_level: InterruptLevel
  }

  class GroupSteps <<component>> {
    steps: []const StepDef
    current_index: u8
  }

  class StepDef <<struct>> {
    type: StepType
  }

  enum StepType {
    Pickup
    Cook
    Store
    Craft
    ...
  }

  class GroupAssignedTo <<component>> {
    worker: Entity
  }

  class CurrentGroup <<component>> {
    group: Entity
  }

  GroupSteps --> StepDef : contains
  StepDef --> StepType : has

  note bottom of GroupAssignedTo
    Added to group entity
  end note

  note bottom of CurrentGroup
    Added to worker entity
  end note
}

package "Reservations" {
  class ReservedBy <<component>> {
    task: Entity
  }

  class Reserves <<component>> {
    resources: []Entity
  }

  note bottom of ReservedBy
    Added to resource entity
  end note

  note bottom of Reserves
    Added to task/group entity
  end note
}

@enduml

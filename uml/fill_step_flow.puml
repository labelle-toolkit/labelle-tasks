@startuml fill_step_flow
title Fill Step - Execution Flow

participant "TaskManager" as tm
participant "GroupSteps" as steps
participant "Callbacks" as cb
participant "Worker" as worker

== Execute Fill Step ==

tm -> steps : get current step
steps --> tm : StepDef{ type=Fill, target=internal_meat_slot }

tm -> cb : findSource(registry, internal_meat_slot)
note right
  User logic:
  1. Get item type needed by target
  2. Find external storages with that item
  3. Return closest/best available
end note

alt source found
  cb --> tm : meat_storage_b
  tm -> worker : go to meat_storage_b
  worker -> worker : pickup meat
  tm -> worker : go to internal_meat_slot
  worker -> worker : drop meat
  tm -> steps : advanceStep()
else no source available
  cb --> tm : null
  tm -> tm : step blocked\n(wait or handle error)
end

@enduml
